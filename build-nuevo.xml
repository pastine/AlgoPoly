<project xmlns:ivy="antlib:org.apache.ivy.ant" name="TP2 - Java" basedir="." default="correr.test.modelo">

	<property name="modelo.src.dir" value="src/modelo" />
	<property name="modelo.test.dir" value="test/modelo" />
	<property name="build.modelo.clases.dir" value="build/clases/modelo"/>
	<property name="build.modelo.test.dir" value="build/test/modelo" />


	<!-- Ivy customization -->
	<property name="ivy.install.version" value="2.2.0" />
	<property name="ivy.jar.dir" value="${libs}/" />
	<property name="ivy.jar.file" value="${ivy.jar.dir}/ivy.jar" />
	<!-- End of 'Ivy customization -->


	<!-- agrupa todos los archivos en subdir de modelo/src que 
		tengan extencion .class -->
	<path id="modelo.clases">
		<filetype dir="${modelo.scr.dir}">
			<include name="**/*.class" /> 
		</filetype>
	</path>


	<!-- agrupa todos los archivos en subdirectorios de modelo/test que 
		contengan la palabra Test al final del nombre -->
	<path id="modelo.test">
		<filetype dir="${modelo.test.dir}">
			<include name="**/*Test*" />
		</filetype>
	</path>

	<!-- compila todas las clases del modelo -->
	<target name="compilar.clases.modelo" description="Compila las clases del modelo">
		<mkdir dir="${build.modelo.clases.dir}" />
		<javac srcdir="${modelo.src.dir}" dstdir="${build.modelo.clases.dir}">
			<classpath refid="modelo.clases" />
		</javac>
	</target>

	<!-- compila todos los tests del modelo -->
	<target name="compilar.test.modelo" description="Compila los tests del modelo">
		<mkdir dir="${build.modelo.test.dir}" />
		<javac srcdir="${modelo.test.dir}" dstdir="${build.modelo.test.dir}">
			<classpath refid="modelo.test" />
		</javac>
	</target>
	
	<!-- llama a los targets que compilan los tests y las clases del modelo -->
	<target name="compilar.modelo" depends="compilar.clases.modelo,compilar.test.modelo" />

	<!-- corre los tests del modelo con junit -->
	<target name="correr.test.modelo" depends="compilar.modelo">
		<junit failurePropertyy="test.fail" showOutput="yes">
			<formater type="failure" />
			<batchtest>
				<fileset dir="${build.modelo.test.dir}" inlcudes="**/*Test.class" />
				<fileset dir="${build.modelo.test.dir}" inlcudes="**/*Prueba.class" />
			</batchtest>	


		</junit>
	</target>


	<!-- Ivy installation -->
	<target name="download-ivy" unless="skip.download">
		<mkdir dir="${ivy.jar.dir}" />
		<!-- download Ivy from web site so that it can be used even 
         without any special installation -->
		<echo message="installing ivy..." />
		<get src="http://repo1.maven.org/maven2/org/apache/ivy/ivy/${ivy.install.version}/ivy-${ivy.install.version}.jar" dest="${ivy.jar.file}" usetimestamp="true" />
	</target>

	<target name="install-ivy" depends="download-ivy" description="--> install ivy">
		<path id="ivy.lib.path">
			<fileset dir="${ivy.jar.dir}" includes="*.jar" />
		</path>
		<taskdef resource="org/apache/ivy/ant/antlib.xml" uri="antlib:org.apache.ivy.ant" classpathref="ivy.lib.path" />
	</target>
	<!-- End of 'Ivy installation -->

	<!-- Resolve dependencies -->
	<target name="resolve" depends="install-ivy" description="--> retrieve dependencies with ivy">
		<ivy:retrieve conf="build" pattern="${libs}/[artifact]-[type]-[revision].[ext]" />
		<ivy:retrieve conf="analysis" pattern="${libs}/analysis/[artifact](-[classifier]).[ext]"/>	
		
	</target>
	<!-- End of 'Resolve dependencies -->

	<!-- limpia el directorio -->
	<target name="clear">
		<delete dir="${build.modelo.clases.dir}" />
		<delete dir="${build.modelo.test.dir}" />
	</target>


</project>